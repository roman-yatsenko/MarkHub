{% extends "base.html" %}

{% load static %}
{% load martortags %}

{% block title %}
  {% if user.is_authenticated %}
    {{ path }} - 
  {% endif %}
{% endblock %}

{% block css %}
  <link href="{% static 'plugins/css/ace.min.css' %}" type="text/css" media="all" rel="stylesheet" />
  <link href="{% static 'martor/css/martor.bootstrap.min.css' %}" type="text/css" media="all" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/delete-modal.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  {% include "branch_path_form.html" %}
  {% if not decode_error %}
  {% endif %}
  {% if contents %}
  <div class="martor-content">
    <div class="martor-preview">
      {{ contents|safe_markdown }}
    </div>
  </div>
  <p>
    <a class="btn btn-outline-primary" href="{% url 'update-file' repo path %}">Update</a> 
    <a class="btn btn-outline-danger" href="#" onclick="document.getElementById('delete-modal').style.display='block'">Delete</a> 
  </p>
  {% endif %}
  <p><a href="{{ html_url }}" target="_blank">Open in the GitHub</a></p>
</div>
  
<div id="delete-modal" class="modal">
  <span onclick="deleteModal.style.display='none'" class="close" title="Close Modal">&times;</span>
<form class="modal-content" action="/">
  {% csrf_token %}
  <div class="container">
    <h1>Delete File</h1>
    <p>Are you sure you want to delete <em>{{ path }}</em> ?</p>
    <div class="clearfix">
      <button type="button" class="cancelbtn" onclick="deleteModal.style.display='none'">Cancel</button>
      <button type="button" class="deletebtn" onclick="location.href='{% url 'delete-file' repo path %}'">Delete</button>
    </div>
  </div>
</form>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static 'plugins/js/highlight.min.js' %}"></script>
<script>
  $('.martor-preview pre').each(function(i, block){
      hljs.highlightBlock(block);
  });
</script>

<script>
// Get the modal
const deleteModal = document.getElementById('delete-modal');
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == deleteModal) {
    deleteModal.style.display = "none";
  }
}
</script>
{% endblock %}
